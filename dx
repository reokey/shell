#!/usr/bin/env bash
PATH=/bin:/sbin:/usr/bin:/usr/sbin:/usr/local/bin:/usr/local/sbin:~/bin
export PATH
clear
sh_ver="0.2"

#取系统信息
get_opsy() {
    [ -f /etc/redhat-release ] && awk '{print ($1,$3~/^[0-9]/?$3:$4)}' /etc/redhat-release && return
    [ -f /etc/os-release ] && awk -F'[= "]' '/PRETTY_NAME/{print $3,$4,$5}' /etc/os-release && return
    [ -f /etc/lsb-release ] && awk -F'[="]+' '/DESCRIPTION/{print $2}' /etc/lsb-release && return
}
opsy=$( get_opsy )
arch=$( uname -m )
lbit=$( getconf LONG_BIT )
kern=$( uname -r )

Update_Shell(){
	echo -e "当前版本为 [ ${sh_ver} ]，开始检测最新版本..."
	sh_new_ver=$(wget --no-check-certificate -qO- "https://raw.githubusercontent.com/reokey/shell/master/dx"|grep 'sh_ver="'|awk -F "=" '{print $NF}'|sed 's/\"//g'|head -1)
	[[ -z ${sh_new_ver} ]] && echo -e "${Error} 检测最新版本失败 !" && exit 0
	if [[ ${sh_new_ver} != ${sh_ver} ]]; then
		echo -e "发现新版本[ ${sh_new_ver} ]，是否更新？[Y/n]"
		stty erase '^H' && read -p "(默认: y):" yn
		[[ -z "${yn}" ]] && yn="y"
		if [[ ${yn} == [Yy] ]]; then
			wget -N --no-check-certificate https://raw.githubusercontent.com/reokey/shell/master/dx && chmod +x dx
			echo -e "脚本已更新为最新版本[ ${sh_new_ver} ] !"
		else
			echo && echo "	已取消..." && echo
		fi
	else
		clear
		echo -e "当前已是最新版本[ ${sh_new_ver} ] !"
	fi
}

echo -e "\033[32m┌───────────── 达奚Linux一键管理脚本 [Ver ${sh_ver}] https://reokey.com ─────────────┐\033[0m"
echo -e "\033[32m│                                                                              │\033[0m"
echo -e "\033[32m│                                                                              │\033[0m"
echo -e "\033[32m│                                                       达奚瀚泽 TG:3727638611 │\033[0m"
echo -e "\033[32m└──────────────────────────────────────────────────────────────────────────────┘\033[0m"
echo
echo -e "\033[32m系统: $opsy  架构: $arch[$lbit Bit]  内核: $kern\033[0m"
echo
echo -e "\033[33m┌──────────────────────────────────────────────────────────────────────────────┐\033[0m"
echo -e "\033[33m│    0 更换系统    1 内核升级    2 系统优化    3 系统加固    4 系统其他        │\033[0m"
echo -e "\033[33m│    5 未知命令    6 未知命令    7 未知命令    8 未知命令    9 未知命令        │\033[0m"
echo -e "\033[33m└──────────────────────────────────────────────────────────────────────────────┘\033[0m"
echo
echo -e "\033[33m                                                                升级脚本输入'z'\033[0m"
echo
echo -e "\033[32m┌──────────────────────────────────────────────────────────────────────────────┐\033[0m"
echo -e "\033[32m│     a Aria2       b 未知命令    c 未知命令    d 未知命令    e 未知命令       │\033[0m"
echo -e "\033[32m│     f Frp         g 未知命令    h 未知命令    i 未知命令    j 未知命令       │\033[0m"
echo -e "\033[32m│     k 未知命令    l Lnmp        m 未知命令    n 未知命令    o 未知命令       │\033[0m"
echo -e "\033[32m│     p 未知命令    q 未知命令    r 未知命令    s Shadowsocks t 未知命令       │\033[0m"
echo -e "\033[32m│     u 未知命令    v 未知命令    w 未知命令    x 未知命令    y 未知命令       │\033[0m"
echo -e "\033[32m└──────────────────────────────────────────────────────────────────────────────┘\033[0m"
echo -e "\033[32m 请输入数字 [0-9]或[a-z]:\033[0m"
read num
case "$num" in
			[0] )
				read -p "更换系统"
		;;
			[1] )
				rm -rf dx-1
				curl -# -o dx-sys https://raw.githubusercontent.com/reokey/shell/master/dx/dx-1
				sh dx-1
		;;
			[2] )
				read -p "系统优化"
		;;
			[3] )
				read -p "系统加固"
		;;
			[4] )
				read -p "系统其他"
		;;
			[5] )
				read -p "未知命令"
		;;
			[6] )
				read -p "未知命令"
		;;
			[7] )
				read -p "未知命令"
		;;
			[8] )
				read -p "未知命令"
		;;
			[9] )
				read -p "未知命令"
		;;
			[a] )
				read -p "Aria2"
		;;
			[b] )
				read -p "未知命令"
		;;
			[c] )
				read -p "未知命令"
		;;
			[d] )
				read -p "未知命令"
		;;
			[e] )
				read -p "未知命令"
		;;
			[f] )
				read -p "Frp"
		;;
			[g] )
				read -p "未知命令"
		;;
			[h] )
				read -p "未知命令"
		;;
			[i] )
				read -p "未知命令"
		;;
			[j] )
				read -p "未知命令"
		;;
			[k] )
				read -p "未知命令"
		;;
			[l] )
				read -p "Lnmp"
		;;
			[m] )
				read -p "未知命令"
		;;
			[n] )
				read -p "未知命令"
		;;
			[o] )
				read -p "未知命令"
		;;
			[p] )
				read -p "未知命令"
		;;
			[q] )
				read -p "未知命令"
		;;
			[r] )
				read -p "未知命令"
		;;
			[s] )
				read -p "Shadowsocks"
		;;
			[t] )
				read -p "未知命令"
		;;
			[u] )
				read -p "未知命令"
		;;
			[v] )
				read -p "未知命令"
		;;
			[w] )
				read -p "未知命令"
		;;
			[x] )
				read -p "未知命令"
		;;
			[y] )
				read -p "未知命令"
		;;
			[z] )
				Update_Shell
		;;
		*) echo -e "\033[31m 输入错误,请重新输入.\033[0m";;
	esac